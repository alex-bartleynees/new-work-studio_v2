---
import ContactMenu from "../../components/contact-menu.astro";
import ImageViewer from "../../components/image-viewer.svelte";
import Layout from "../../components/layout.astro";
import TitleLink from "../../components/title-link.astro";
import "../../styles/global.css";
import { useSanityClient } from "astro-sanity";

export async function getStaticPaths() {
  const projects = await useSanityClient().fetch(`*[_type == "projects"]`);

  return projects.map((project) => {
    return {
      params: { slug: project.slug.current },
      props: {
        project,
        projects,
      },
    };
  });
}

const { project, projects } = Astro.props;
const projectIndex = projects.findIndex(
  (p) => p.slug.current === project.slug.current
);
const nextProject = projects[projectIndex + 1] || projects[0];
---

<Layout title={`${project.title} | Tim Nees Architects`} bodyClass="backdrop">
  <TitleLink link="/" />
  <ImageViewer
    client:load
    images={project.images}
    nextProject={nextProject}
    project={project}
    keyword="project"
  />

  <ContactMenu isMobile={true} />
</Layout>
