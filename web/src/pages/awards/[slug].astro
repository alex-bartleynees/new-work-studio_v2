---
import ContactMenu from "../../components/contact-menu.astro";
import ImageViewer from "../../components/image-viewer.svelte";
import Layout from "../../components/layout.astro";
import TitleLink from "../../components/title-link.astro";
import "../../styles/global.css";
import { useSanityClient } from "astro-sanity";

export async function getStaticPaths() {
  const awards = await useSanityClient().fetch(`*[_type == "awards"]`);
  return awards.map((award) => {
    return {
      params: { slug: award.slug.current },
      props: {
        award,
        awards,
      },
    };
  });
}

const { award, awards } = Astro.props;

const awardIndex = awards.findIndex(
  (p) => p.slug.current === award.slug.current
);
const nextAward = awards[awardIndex + 1] || awards[0];
---

<Layout title={`${award.title} | Tim Nees Architects}`} bodyClass="backdrop">
  <TitleLink link="/" />
  <ImageViewer
    client:load
    images={award.images}
    nextProject={nextAward}
    project={award}
    keyword="award"
  />
  <ContactMenu isMobile={true} />
</Layout>
